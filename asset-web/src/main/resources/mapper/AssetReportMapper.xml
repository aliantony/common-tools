<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.antiy.asset.dao.AssetReportDao">
    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.antiy.asset.entity.AssetAreaEntity">
        <id column="areaAssetCount" property="areaAssetCount"/>
        <result column="areaId" property="areaId"/>
        <result column="date" property="date"/>
    </resultMap>
    <!--按天统计总数-->
    <select id="getAllAssetWithArea" resultMap="BaseResultMap"
            parameterType="com.antiy.asset.vo.request.ReportQueryRequest">

        SELECT
        count( 1 ) AS areaCount,
        FROM_UNIXTIME( gmt_create / 1000, '%Y-%m-%d' ) AS date,
        CASE
        <foreach collection="assetAreaIds" item="item">
            WHEN area_id IN (#{item.parentAreaId},
            <foreach collection="item.childrenAradIds" separator="," item="area">
                #{area}
            </foreach>
            )
            THEN #{item.parentAreaId}
        </foreach>
        ELSE area_id
        END AS areaId
        FROM
        asset
        WHERE
        FROM_UNIXTIME( gmt_create, '%Y-%m-%d') &lt; #{startTime}
        AND asset_status != '9'
        AND STATUS = 1
        AND area_id in
        <foreach collection="assetAreaIds" item="item" open="(" close=")" separator=",">
            <foreach collection="item.childrenAradIds" separator="," item="area">
                #{area}
            </foreach>
        </foreach>
        GROUP BY
        area_id
        ORDER BY
        areaCount DESC
    </select>


</mapper>
